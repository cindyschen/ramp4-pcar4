import{fy as U,ar as k,fR as se,e8 as a,e9 as t,ea as b,fU as I,fJ as Z,fI as Q,iI as ce,fL as R,fM as q,e7 as ie,il as Y,fC as _,fK as A,fD as F,is as ve,fW as ne,fz as V,ls as ue,fP as X,fQ as K,fT as ee,fG as T,fE as W,fS as te,kP as pe,lx as me,iC as Ee,m2 as _e,fq as le,fV as re,fH as ye,fF as Me,jm as je}from"./main-DY2G44KD.js";import{T as He}from"./toggle-switch-control-BUeifhqX.js";const Ce={key:0,class:"relative"},ze={key:0,class:"relative"},Oe=["innerHTML"],qe=["src"],De={key:1,class:"w-32 h-32"},Ie={class:"symbologyIcon"},$e=["innerHTML"],Be=["src"],Ne={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Ae={key:0,class:"px-5"},Fe={key:1,class:"inline-flex justify-center items-center relative"},Pe=U({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(v){const x=v,s=k([]);return se(()=>{s.value=x.layer.legend}),(c,m)=>v.result.loaded?(t(),a("div",Ce,[b("div",{class:R(v.result.items.length===0?"opacity-50":"")},[s.value.length>1?(t(),a("div",ze,[(t(!0),a(Z,null,Q(s.value.slice(0,3).reverse(),(L,g)=>(t(),a("div",{class:R(["absolute",[g==0?"symbol-0":g==1?"left-3":"left-6"]]),style:ce({"z-index":3-g}),key:g},[s.value[g].svgcode?(t(),a("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:s.value[g].svgcode},null,8,Oe)):s.value[g].imgUrl?(t(),a("img",{key:1,class:"symbologyIcon w-28 h-28",src:s.value[g].imgUrl},null,8,qe)):I("",!0)],6))),128))])):s.value.length>0?(t(),a("div",De,[b("div",Ie,[s.value[0].svgcode?(t(),a("span",{key:0,innerHTML:s.value[0].svgcode},null,8,$e)):s.value[0].imgUrl?(t(),a("img",{key:1,class:"symbologyIcon w-full h-full",src:s.value[0].imgUrl},null,8,Be)):I("",!0)])])):I("",!0)],2),b("div",Ne,[v.result.loaded?(t(),a("div",Ae,q(v.result.items.length),1)):I("",!0)])])):(t(),a("div",Fe,m[0]||(m[0]=[b("div",{class:"symbologyIcon h-32 w-32"},[b("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Se=ie(Pe,[["__scopeId","data-v-496d788d"]]),Ue=["content"],Ge={class:"symbologyLayerName truncate"},Re=U({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(v){const x=Y(),s=_(()=>x.properties),c=v,m=()=>{const L=c.layer;return L&&s.value[L.id]&&s.value[L.id].name?s.value[L.id].name:L?.name??""};return(L,g)=>{const E=A("tippy");return F((t(),a("button",{class:R(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",v.selected?"detailsButtonSelected":"px-11"]),onClick:g[0]||(g[0]=ve(()=>{},["stop"])),content:m()},[ne(Se,{class:"symbStack w-32 h-32 mr-10",layer:v.layer,result:v.result},null,8,["layer","result"]),b("div",Ge,q(m()),1)],10,Ue)),[[E,{placement:"right",sticky:!0}]])}}}),Ke=["content"],Ve=U({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(v,{emit:x}){const{t:s}=V(),c=ue(),m=k(),L=()=>{m.value._tippy.hide()},g=h=>{h.key==="Tab"&&m.value?.matches(":focus")&&m.value._tippy.show()},E=x,f=v,l=k(""),y=k([]),u=k(!1),e=k(!1),r=h=>c.getLayerByUid(h),M=h=>{l.value=h,E("selection-changed",h),u.value=!1},$=()=>{e.value||setTimeout(()=>{u.value=e.value},500),e.value=!0},C=()=>{u.value=e.value=!1},N=()=>{e.value||(u.value=!0),e.value=!0},o=()=>{u.value=e.value=!1};return X(()=>{y.value.push(K(f,()=>{l.value=f.selected}))}),se(()=>{m.value?.addEventListener("blur",L),m.value?.addEventListener("keyup",g)}),ee(()=>{y.value.forEach(h=>h()),m.value?.removeEventListener("blur",L),m.value?.removeEventListener("keyup",g)}),(h,H)=>{const B=A("focus-item"),P=A("focus-list"),O=A("tippy");return F((t(),a("div",{class:R(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":u.value}]),onMouseover:$,onMouseleave:C,onFocus:N,onBlur:ve(o,["self"]),content:T(s)("details.layers.results.list.tooltip"),ref_key:"el",ref:m},[(t(!0),a(Z,null,Q(f.results,(j,n)=>(t(),a("div",{class:"flex justify-start relative",key:n},[F((t(),W(Re,{key:j.uid,layer:r(j.uid),result:j,selected:j.uid===l.value,onClick:d=>M(j.uid)},null,8,["layer","result","selected","onClick"])),[[B]])]))),128))],42,Ke)),[[P],[O,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),We={class:"inline font-bold"},Ze=["innerHTML"],Je=U({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(v){const{t:x}=V(),s=te("iApi"),c=v,m=(l,y,u,e)=>{const r=l.find(M=>M[y].toLowerCase()===u.toLowerCase());r&&delete e[r.name]},L=()=>{const l=Object.assign({},c.identifyData.data);m(c.fields,"type","geometry",l),s.ui.exposeOids||m(c.fields,"type","oid",l),s.ui.exposeMeasurements||(m(c.fields,"name","shape_length",l),m(c.fields,"name","shape_area",l));const y={};c.fields.forEach(e=>{const r=c.fixtureFields?.find(M=>e.name===M.field);y[e.name]={name:r?.alias||e.alias||e.name,type:e.type,visible:r?.visible??!0}});const u={};Object.keys(l).forEach(e=>{const r=y[e];if(r&&r.visible){const M=l[e];u[e]={value:typeof M=="number"?s.ui.formatNumber(M):M,alias:r.name,type:r.type}}});for(const[e]of Object.entries(u))s.ui.isPlainText(u[e].value)&&(u[e].value=s.ui.escapeHtml(u[e].value));return u},g=(l,y,u)=>{switch(u){case"date":return f(l);default:return E(l,y)}},E=(l,y)=>{if(!l)return l;if(l.trim().match(/\.(jpeg|jpg|gif|png)$/)||l.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${l}" alt="${x("details.item.alert.defaultAltText",{alias:y})}" />`;const u="underline text-blue-700 break-all",e=document.createElement("div");return e.innerHTML=l.trim(),e.firstElementChild?.tagName=="A"?(e.firstElementChild.className=u,e.innerHTML):pe(l,{className:u,target:"_blank",validate:{url:r=>/^https?:\/\//.test(r)}})},f=l=>{const y=parseInt(l);return isNaN(y)?l:new Date(y).toISOString().split("T")[0]};return(l,y)=>(t(),a("div",null,[(t(!0),a(Z,null,Q(L(),(u,e,r)=>(t(),a("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:r},[b("span",We,q(u.alias),1),y[0]||(y[0]=b("span",{class:"flex-auto"},null,-1)),b("span",{class:"inline",innerHTML:g(u.value,u.alias,u.type)},null,8,Ze)]))),128))]))}}),Qe=["innerHTML"],Ye={key:1},Xe=U({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(v){const{t:x}=V();return(s,c)=>v.identifyData?(t(),a("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:v.identifyData.data.data??v.identifyData.data},null,8,Qe)):(t(),a("div",Ye,q(T(x)("details.layers.results.empty")),1))}}),et={class:"relative flex flex-grow truncate"},tt={key:0,class:"flex flex-grow items-center truncate"},lt={class:"flex p-8 items-center"},at=["innerHTML"],st={key:1,class:"symbologyIcon p-6"},it=["content","innerHTML","tabindex"],nt={key:1,class:"flex p-6 flex-grow"},ut={key:2,class:"zoomButton text-center p-3"},rt=["content","aria-label"],ot={key:0,class:"m-auto animate-spin spinner h-20 w-20"},dt={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},ct={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},vt=["innerHTML"],fe=U({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(v){const x=ue(),s=v,c=te("iApi"),m=k([]),L=Y(),{t:g}=V(),E=k(!1),f=k(""),l=k("none"),y=k(),u=()=>x.getLayerByUid(s.uid),e=_(()=>L.properties),r=_(()=>L.defaultTemplates),M=_(()=>u()?.supportsFeatures??!1),$=_(()=>u()?.mapLayer??!1),C=_(()=>{const n=u();let d=n&&s.data.loaded?n.nameValue(s.data.data):c.$i18n.t("details.items.title");return c.ui.isPlainText(d)&&(d=c.ui.escapeHtml(d)),d}),N=n=>{if(typeof n=="string"){const d="underline text-blue-700 break-all",p=document.createElement("div");return p.innerHTML=n.trim(),p.firstElementChild?.tagName=="A"?(p.firstElementChild.className=d,p.innerHTML):pe(n,{className:d,target:"_blank",validate:{url:z=>/^https?:\/\//.test(z)}})}return n},o=()=>{O("none"),s.data.loaded?h():s.data.load().then(()=>{h()})},h=()=>{if(f.value="",!(s.data&&s.data.loaded))return;const n=u();if(n===void 0){console.warn(`could not find layer for uid ${s.uid} during icon lookup`);return}if(n.supportsFeatures){const d=n.oidField;n.getIcon(s.data.data[d]).then(p=>{f.value=p})}},H=_(()=>{const n=u(),d=n&&e.value[n.id]&&e.value[n.id].template;if(d){if(typeof me(d)!="string")return d;console.error(`Could not find custom details template named ${d}. Was it registered correctly?`)}return r.value&&r.value[s.data.format]?r.value[s.data.format]:M.value?Je:Xe}),B=_(()=>M.value?u()?.fields||[]:[]),P=_(()=>{const n=u();if(n&&e.value[n.id]&&e.value[n.id].fields)return e.value[n.id].fields}),O=n=>{n==="zoomed"||n==="error"?setTimeout(()=>{l.value=n,y.value?._tippy.show(),setTimeout(()=>{y.value?._tippy.hide(),l.value="none"},3e3)},300):l.value=n},j=()=>{if(l.value!=="none")return;O("zooming");const n=u();if(n===void 0||!n.isLoaded){console.warn(`Could not find layer for uid ${s.uid} during zoom geometry lookup`),O("error");return}if(!s.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),O("error");return}const d=s.data.data[n.oidField],p=()=>{const z={getGeom:!0};n.getGraphic(d,z).then(D=>{D.geometry.invalid()?(console.error(`Could not find graphic for objectid ${d}`),O("error")):(c.geo.map.zoomMapTo(D.geometry),O("zoomed"),c.updateAlert(c.$i18n.t("details.item.alert.zoom")))}).catch(()=>{O("error")})};n.layerType===Ee.FEATURE&&n.geomType!==_e.POINT?n.getGraphicExtent(d).then(z=>{c.geo.map.zoomMapTo(z),O("zoomed"),c.updateAlert(c.$i18n.t("details.item.alert.zoom"))}).catch(()=>{p()}):p()};return X(()=>{m.value.push(K(s,()=>{o()},{deep:!1,immediate:!0}))}),ee(()=>{m.value.forEach(n=>n())}),(n,d)=>{const p=A("truncate"),z=A("tippy");return t(),a(Z,null,[b("div",et,[M.value?(t(),a("div",tt,[b("div",lt,[v.data.loaded&&f.value?(t(),a("span",{key:0,class:"flex-none symbologyIcon",innerHTML:f.value},null,8,at)):(t(),a("div",st,d[3]||(d[3]=[b("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),v.data.loaded?F((t(),a("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:C.value,innerHTML:N(C.value),onTouchstart:d[0]||(d[0]=D=>E.value=!0),onTouchend:d[1]||(d[1]=D=>E.value=!1),tabindex:v.inList?-1:0},null,40,it)),[[p,{options:{placement:"top-start",offset:()=>E.value?[0,25]:[0,0]}}]]):(t(),a("div",nt,q(T(g)("details.loading")),1)),v.data.loaded?(t(),a("span",ut,[$.value?F((t(),a("button",{key:0,type:"button",content:T(g)(`details.item.zoom${l.value==="none"?"":`.${l.value}`}`),"aria-label":T(g)(`grid.cells.zoom${l.value==="none"?"":`.${l.value}`}`),ref_key:"zoomButton",ref:y,onClick:d[2]||(d[2]=D=>{D.stopPropagation(),j()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[l.value==="zooming"?(t(),a("div",ot)):l.value==="zoomed"?(t(),a("svg",dt,d[4]||(d[4]=[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):l.value==="error"?(t(),a("svg",ct,d[5]||(d[5]=[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(t(),a("span",{key:3,innerHTML:T(c).ui.getZoomIcon()},null,8,vt))],8,rt)),[[z,{placement:"bottom"}]]):I("",!0)])):I("",!0)])):I("",!0)]),v.open?(t(),W(me(H.value),{key:0,identifyData:v.data,fields:B.value,fixtureFields:P.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):I("",!0)],64)}}}),pt={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},mt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},yt={for:"toggle"},ft={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},gt={class:"flex"},ht=["aria-label"],bt=["content","aria-label","disabled"],xt={class:"px-3 text-center flex-grow"},kt=["content","aria-label","disabled"],wt={key:3},Tt={key:0},Lt=["content"],Et=["onClick"],_t={key:1,class:"text-center"},Mt={key:4,class:"p-5"},jt=U({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},setup(v){const x=k(),s=()=>{x.value._tippy.hide()},c=i=>{i.key==="Tab"&&x.value?.matches(":focus")&&x.value._tippy.show()},m=te("iApi"),L=Y(),g=ue(),E=v,{t:f}=V(),l=k(!1),y=k(m.fixture.get("details")),u=k(!0),e=k(!1),r=k(0),M=k(20),$=k([]),C=k([]),N=_(()=>L.activeGreedy),o=_(()=>L.properties),h=_(()=>r.value+M.value),H=()=>g.getLayerByUid(E.uid),B=()=>E.results.find(i=>i.uid===E.uid),P=_(()=>B()?.loaded??!1),O=_(()=>B()?.requestTime),j=_(()=>l.value&&(!e.value&&p().length>1||e.value&&p().length>M.value)),n=_(()=>{const i=H();return i&&o.value[i.id]&&o.value[i.id].name?o.value[i.id].name:i?.name??""}),d=_(()=>E.uid),p=()=>{const i=B();return i?i.items:[]},z=_(()=>p()[r.value]),D=_(()=>{if(y.value.hasHilighter()){const i=H();if(i)return i.mapLayer&&i.supportsFeatures}return!1}),ge=i=>{u.value=i,L.hilightToggle=i,S()},he=()=>{const i=H();r.value=r.value??0,u.value=L.hilightToggle??u.value,e.value=!1,l.value=!!i,S()},oe=i=>{e.value?(r.value+=i*M.value,S()):r.value+=i},S=async(i=!1)=>{if(u.value&&D.value){if(i){const G=B();G&&await G.loading}const w=p();if(P.value&&w.length>0){if(e.value)y.value.hilightDetailsItems(w.slice(r.value,h.value),E.uid);else{const G=w[r.value];G&&y.value.hilightDetailsItems([G],E.uid)}return}}y.value.removeDetailsHilight()},be=()=>{e.value=!0,r.value=Math.floor(r.value/M.value)*M.value,S()},xe=()=>{y.value.removeDetailsHilight(),C.value.forEach(i=>i()),$.value.forEach(i=>m.event.off(i))},ke=()=>{y.value.removeDetailsHilight()},we=i=>{const w=r.value;r.value=i,e.value=!1,w===i&&S()};return se(()=>{$.value.push(m.event.on(le.LAYER_REMOVE,i=>{const w=m.panel.get("details");E.uid===i.uid&&w&&w.close()})),$.value.push(m.event.on(le.PANEL_CLOSED,i=>{i.id==="details"&&xe()})),$.value.push(m.event.on(le.PANEL_MINIMIZED,i=>{i.id==="details"&&ke()})),$.value.push(m.event.on(le.MAP_BASEMAPCHANGE,i=>{u.value&&i.schemaChanged&&S()})),x.value?.addEventListener("blur",s),x.value?.addEventListener("keyup",c)}),X(()=>{C.value.push(K(z,()=>{e.value||(he(),z.value===void 0&&y.value.removeDetailsHilight())},{deep:!1,immediate:!0})),C.value.push(K(d,()=>{const i=E.uid;if(e.value&&i){const w=B();w&&w.loading.then(()=>{E.uid===i&&e.value&&S()})}},{deep:!1,immediate:!0})),C.value.push(K(O,()=>{r.value=0,e.value&&S(!0)})),C.value.push(K(()=>E.uid,()=>{r.value=0}))}),ee(()=>{x.value?.removeEventListener("blur",s),x.value?.removeEventListener("keyup",c)}),(i,w)=>{const G=A("truncate"),ae=A("tippy"),Te=A("focus-item"),Le=A("focus-list");return P.value&&N.value===0?(t(),a("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:ce(v.results.length>1?{"margin-left":"42px"}:"")},[l.value?F((t(),a("h1",pt,[re(q(n.value),1)])),[[G,{options:{placement:"top-start"}}]]):I("",!0),D.value?(t(),a("div",mt,[b("label",yt,q(T(f)("details.togglehilight.title")),1),ne(He,{config:{value:u.value,disabled:!1},onToggled:ge},null,8,["config"])])):I("",!0),j.value?(t(),a("div",ft,[b("div",gt,[e.value?I("",!0):(t(),a("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":T(f)("details.item.see.list"),onClick:w[0]||(w[0]=J=>be())},q(T(f)("details.item.see.list")),9,ht)),b("div",{class:R(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":e.value}])},[F((t(),a("button",{type:"button",content:T(f)(e.value?"details.items.previous":"details.item.previous.item"),onClick:w[1]||(w[1]=J=>oe(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":T(f)(e.value?"details.items.previous":"details.item.previous.item"),disabled:r.value===0},w[3]||(w[3]=[b("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[b("g",null,[b("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,bt)),[[ae,{placement:"top"}]]),b("span",xt,q(e.value?T(f)("details.items.range",[r.value+1,Math.min(h.value,p().length),p().length]):T(f)("details.item.count",[r.value+1,p().length])),1),F((t(),a("button",{type:"button",content:T(f)(e.value?"details.items.next":"details.item.next.item"),onClick:w[2]||(w[2]=J=>oe(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":T(f)(e.value?"details.items.next":"details.item.next.item"),disabled:!e.value&&r.value===p().length-1||e.value&&h.value>=p().length},w[4]||(w[4]=[b("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[b("g",null,[b("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,kt)),[[ae,{placement:"top"}]])],2)])])):I("",!0),l.value?(t(),a("div",wt,[p().length>0?(t(),a("div",Tt,[e.value?F((t(),a("div",{key:0,class:"flex flex-col",content:T(f)("details.layers.results.list.tooltip"),ref_key:"el",ref:x},[(t(!0),a(Z,null,Q(p().slice(r.value,h.value),(J,de)=>F((t(),a("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:de,onClick:Dt=>we(r.value+de)},[ne(fe,{data:J,uid:v.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,Et)),[[Te,"show-truncate"]])),128))],8,Lt)),[[Le],[ae,{trigger:"manual",placement:"top-start",touch:!1}]]):(t(),W(fe,{key:1,data:z.value,uid:v.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(t(),a("div",_t,q(T(f)("details.layers.results.empty.currentLayer")),1))])):(t(),a("div",Mt,q(T(f)("details.item.no.data")),1))],4)):(t(),a("div",{key:1,class:R(["flex justify-center py-10 items-center",v.results.length>1?"ml-42":""])},[w[5]||(w[5]=b("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),re(" "+q(T(f)("details.item.loading")),1)],2))}}}),Ht=ie(jt,[["__scopeId","data-v-1efeb63f"]]),Ct={class:"relative h-full"},zt={class:"detailsContentSection overflow-y-auto h-full"},Ot=U({__name:"details-screen",props:{panel:{type:Object}},setup(v){const{t:x}=V(),s=te("iApi"),c=Y(),m=k([]),L=k([]),g=k([]),E=k(!1),f=k(""),l=_(()=>c.activeGreedy),y=_(()=>c.payload),u=_(()=>c.properties),e=o=>{f.value=o},r=o=>g.value.find(h=>h.uid===o),M=o=>{o!==void 0&&(c.activeGreedy=o.length===0?0:o[0].requestTime,g.value=o,$(o))},$=o=>{if(f.value){const h=r(f.value);h?h.loading.then(()=>{h.requestTime===l.value&&(h.items.length>0?N(!1):C(o))}):C(o)}else C(o)},C=(o,h)=>{let H;if(h)H=h;else{const j=c.properties,n=o.map(p=>[j[p.layerId]?.priority??50,p.layerId]),d=new Set(n.map(p=>p[0]));H=[],d.forEach(p=>{const z=n.filter(D=>D[0]===p).map(D=>D[1]);H.push([p,z])}),H.sort((p,z)=>z[0]-p[0])}if(H.length===0){y.value.length?N(!0):je().then(()=>{N(!0)});return}const B=H[H.length-1][1],P=o.filter(j=>B.includes(j.layerId)).map(j=>j.loading.then(()=>j.items.length>0?Promise.resolve(j):Promise.reject())),O=o.length===0?0:o[0].requestTime;Promise.any(P).then(j=>{j.requestTime===l.value&&(f.value=j.uid,N(!1))}).catch(()=>{O===l.value&&(H.pop(),C(o,H))})},N=o=>{c.activeGreedy=0,E.value=o};return X(()=>{L.value.push(K(y,o=>{M(o)},{deep:!1,immediate:!0}))}),ee(()=>{m.value.forEach(o=>s.event.off(o)),L.value.forEach(o=>o())}),(o,h)=>{const H=Me("panel-screen");return t(),W(H,{panel:v.panel},{header:ye(()=>[re(q(T(c).origin==="toggleEvent"?T(x)("details.layers.title.gridOrigin"):T(x)("details.layers.title.identifyOrigin")),1)]),content:ye(()=>[b("div",Ct,[g.value.length>1?(t(),W(Ve,{key:0,results:g.value,detailsProperties:u.value,selected:f.value,onSelectionChanged:e},null,8,["results","detailsProperties","selected"])):I("",!0),b("div",zt,[E.value?(t(),a("div",{key:1,class:R(["text-center",{"ml-42":g.value.length>1}])},q(g.value.length>=1?T(x)("details.layers.results.empty"):T(x)("details.layers.results.empty.noLayers")),3)):(t(),W(Ht,{key:0,uid:f.value,results:g.value},null,8,["uid","results"]))])])]),_:1},8,["panel"])}}}),qt=ie(Ot,[["__scopeId","data-v-059182ed"]]);export{qt as default};
