import{iV as $,j0 as x,gn as _,i as m,cj as b,aa as d,_ as r,Y as o,Z as q,bJ as F,au as I,am as S,O as y,aw as c,av as P,j2 as h,bp as j,s as T,bI as R,D as J,a6 as g,bU as N,a7 as E}from"./main-DgDrvCr-.js";import{l as z}from"./MultiOriginJSONSupport-CYIyzYmY.js";import{s as D,o as C}from"./GraphicOrigin-CFbDTX7K.js";import{p as L}from"./workers-DSMqyyzO.js";import{p as Q,i as U,s as k,a as V,c as u}from"./parquetUtils-D0XHU9xZ.js";import{g as A}from"./FeatureSet-CyFyAscH.js";import{p as G}from"./BlendLayer-Cdi5goXk.js";import{s as W}from"./CustomParametersMixin-nN27j8rM.js";import{a as H}from"./DisplayFilteredLayer-nteyMuuE.js";import{c as M}from"./FeatureEffectLayer-Dxu1dIZb.js";import{f as B}from"./FeatureReductionLayer-DcfpHdEa.js";import{b as Y,p as Z,d as K,l as X}from"./OperationalLayer-BPM7ieqc.js";import{p as ee}from"./OrderedLayer-D-js9AOL.js";import{t as te}from"./ScaleRangeLayer-DwkTx_03.js";import{l as re}from"./TemporalLayer-BEOgQGLA.js";import{a as ie}from"./FeatureTemplate-DeHUHMyL.js";import{m as oe}from"./Field-CbZjhmh5.js";import{s as se}from"./fieldProperties-Dy4vIwmv.js";import{l as ae,A as ne}from"./labelingInfo-BwS-byGX.js";import{m as pe}from"./typeUtils-LNOZo25S.js";import{b as f}from"./Query-CuYmyL9H.js";import{d as le}from"./popupUtils-D-4g15nx.js";import"./preload-helper-DMGCcr4D.js";import"./Queue-B6dgMT0m.js";import"./intl-CS9xyuVx.js";import"./messages-oaSJHxS5.js";import"./locationUtils-CQw-ZQ_N.js";import"./parquet-Dta8MX69.js";import"./QueueProcessor-Bj_8jznU.js";import"./ReactiveMap-Bb0Hnruf.js";import"./signal-Gqx5-EV0.js";import"./layerContainerType-CSXZNpHb.js";import"./jsonUtils-BTl6XIgF.js";import"./parser-n-ScG99b.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-BktPTKGx.js";import"./scaleUtils-D9Tjskdu.js";import"./uuid-Oe6SV2kF.js";import"./displayFilterUtils-DtjZvMzk.js";import"./FeatureEffect-BvhGiPQR.js";import"./FeatureFilter-CY1znpef.js";import"./fieldType-CVvOJb8A.js";import"./FeatureReductionSelection-GFT2Lfr9.js";import"./jsonUtils-Co0zxGwk.js";import"./ClassBreaksRenderer-B8tLklHY.js";import"./commonProperties-D00LvVBr.js";import"./colorRamps-CU0xJ3L0.js";import"./ColorStop-WKWyuzIM.js";import"./visualVariableUtils-GGCs88uk.js";import"./lengthUtils-C42R7ZlZ.js";import"./RendererLegendOptions-B9W_mHT8.js";import"./LRUCache-DXomAw59.js";import"./MemCache-B4XvYdPn.js";import"./DictionaryScriptEvaluator-DTFxozjX.js";import"./Version-D7F7HKCf.js";import"./FieldsIndex-BI6M0CEC.js";import"./UnknownTimeZone-NV0JDDlV.js";import"./timeZoneUtils-DWZQlidT.js";import"./ArcadeExpression-BWcvkwG7.js";import"./TimeOnly-DfO3fqZF.js";import"./enum-anrtpCcd.js";import"./utils-DQaLv0i_.js";import"./defaultCIMValues-XI-Li77m.js";import"./heatmapUtils-Dl8ed9cm.js";import"./vec42-C9Z81XnB.js";import"./vec4f64-DPb6J-GU.js";import"./SimpleRenderer-C7Dw9vgO.js";import"./UniqueValueRenderer-C5EtsqsD.js";import"./diffUtils-CiYNPUgF.js";import"./styleUtils-DLGHsifj.js";import"./MD5-MtSiOt06.js";import"./ElevationInfo-Cu2NUgcv.js";import"./OrderByInfo-DpPXvB_n.js";import"./TimeInfo-DbER2cql.js";import"./asyncUtils-DjQDeqlO.js";import"./RelationshipQuery-Dqg5BeIa.js";import"./NormalizationBinParametersMixin-p2ReyMlK.js";import"./labelUtils-SpmPi07E.js";const ue=Symbol("isParquetGraphicOrigin");var v;class ye extends D{get[(v=ue,$)](){return this.layer}get[x](){return this.layer}get[C](){return this.layer}constructor(t){super(),this[v]=!0,this.type="parquet",this.layer=t}get id(){return this.layer.id}}let l=class extends _{constructor(e){super(e),this.type="parquet"}load(e){const t=e!=null?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){this._connection?.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{m.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t?.signal})}async queryFeatures(e,t={}){const s=await this.queryFeaturesJSON(e,{signal:t?.signal});return A.fromJSON(s)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t?.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t?.signal})}async queryExtent(e,t){if(this.layer.encoding==null)return m.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const s=await this._proxy.queryExtent(e.toJSON(),{signal:t?.signal});return{count:s.count,extent:b.fromJSON(s.extent)}}async _initialize(e){this._connection=await L("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),d(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:t,capabilities:s}=await this._proxy.load({urls:this.layer.urls.items,fields:this.layer.fields?.map(a=>a.toJSON()),geometryType:this.layer.geometryType?Q(this.layer.geometryType):null,spatialReference:this.layer.spatialReference?.toJSON(),encoding:this.layer.encoding?.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});d(e),this.sourceJSON=t,this.capabilities=s}};r([o()],l.prototype,"type",void 0),r([o({constructOnly:!0})],l.prototype,"layer",void 0),r([o()],l.prototype,"sourceJSON",void 0),r([o()],l.prototype,"capabilities",void 0),l=r([q("esri.layers.graphics.sources.ParquetSource")],l);const w=se(),O="__OBJECTID",me={types:{key:"type",base:V,typeMap:{wkb:k,location:U}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let i=class extends H(B(M(G(ee(re(te(Y(z(W(F(I))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ye(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=O,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!S("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new y}destroy(){this.source?.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([c(()=>this.urls,t=>this.source?.updateFiles(t.items)),c(()=>this.customParameters,t=>this.source?.setCustomParameters(t))]),this}get capabilities(){return this.source?.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,s,a){const n=e.filter(p=>!(p.name===O&&p.type==="oid")).map(p=>p.toJSON(a));P(s,n,t)}get isTable(){return this.encoding==null}set renderer(e){h(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new y(e.type==="files"?e.urls:[])}writeUrls(e,t,s,a){const n=[];if(e?.length){a={blockedRelativeUrls:a?.blockedRelativeUrls};for(let p of e)p=j(p,a),p&&n.push(p)}n.length?t.source={type:"files",urls:n}:a.messages?.push(new T("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return le(this,e)}createQuery(){const e=new f;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new l({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const s=await this.source.queryFeatures(this._normalizeQuery(e),t),a=this.graphicOrigin;if(s?.features)for(const n of s.features)n.layer=n.sourceLayer=this,n.origin=a;return s}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return f.from(e)??this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),h(this.renderer,this.fieldsIndex),R(this.timeInfo,this.fieldsIndex),this.spatialReference==null&&(this.spatialReference=J.WGS84)}};r([o({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([o({type:String})],i.prototype,"copyright",void 0),r([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([o()],i.prototype,"displayOptimization",void 0),r([o({type:[oe],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([g("fields")],i.prototype,"writeFields",null),r([o(w.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([o(me)],i.prototype,"encoding",void 0),r([o({type:b,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([o({type:u.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:u.read},write:{writer:u.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:u.read}}}}})],i.prototype,"geometryType",void 0),r([o({readOnly:!0,clonable:!1})],i.prototype,"graphicOrigin",void 0),r([o(Z)],i.prototype,"labelsVisible",void 0),r([o({type:[ne],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ae},write:!0}})],i.prototype,"labelingInfo",void 0),r([o(K)],i.prototype,"legendEnabled",void 0),r([o()],i.prototype,"file",void 0),r([o({type:String,readOnly:!0})],i.prototype,"objectIdField",void 0),r([o({type:["ParquetLayer"]})],i.prototype,"operationalLayerType",void 0),r([o(w.outFields)],i.prototype,"outFields",void 0),r([o(X)],i.prototype,"popupEnabled",void 0),r([o({type:N,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([o({types:pe,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],i.prototype,"renderer",null),r([o({type:l,readOnly:!0,cast:null,json:{read:!1}})],i.prototype,"source",void 0),r([o({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],i.prototype,"spatialReference",void 0),r([o({type:[ie]})],i.prototype,"templates",void 0),r([o()],i.prototype,"title",void 0),r([o({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([o({type:y.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],i.prototype,"urls",void 0),r([E("urls")],i.prototype,"readUrls",null),r([g("urls")],i.prototype,"writeUrls",null),i=r([q("esri.layers.ParquetLayer")],i);const Dt=i;export{Dt as default};
