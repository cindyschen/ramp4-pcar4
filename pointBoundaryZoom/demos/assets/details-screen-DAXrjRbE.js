import{fy as G,as as x,fR as ie,eb as l,ec as t,ed as _,fU as j,fJ as K,fI as X,iL as pe,fL as R,fM as H,ea as oe,ip as Y,fC as M,fK as q,fD as A,it as me,fZ as ae,fz as J,lw as re,fP as ee,fQ as V,fT as te,fG as L,fE as Z,fS as se,kS as ye,lB as de,iF as Te,m6 as $e,fX as W,fV as ne,fH as ve,fF as Me,jp as Ee}from"./main-BfXtoXUW.js";import{T as Ie}from"./toggle-switch-control-BtcCk8Hm.js";import"./preload-helper-DMGCcr4D.js";const Ce={key:0,class:"relative"},ze={key:0,class:"relative"},De=["innerHTML"],Se=["src"],He={key:1,class:"w-32 h-32"},je={class:"symbologyIcon"},Be=["innerHTML"],Oe=["src"],Ne={class:"badge z-50 rounded-full text-white absolute h-10 w-10 p-8 inline-flex items-center justify-center"},Ae={key:0,class:"px-5"},qe={key:1,class:"inline-flex justify-center items-center relative"},Fe=G({__name:"symbology-stack",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0}},setup(v){const b=v,n=x([]);return ie(()=>{n.value=b.layer.legend}),(d,p)=>v.result.loaded?(t(),l("div",Ce,[_("div",{class:R(v.result.items.length===0?"opacity-50":"")},[n.value.length>1?(t(),l("div",ze,[(t(!0),l(K,null,X(n.value.slice(0,3).reverse(),(w,g)=>(t(),l("div",{class:R(["absolute",[g==0?"symbol-0":g==1?"left-3":"left-6"]]),style:pe({"z-index":3-g}),key:g},[n.value[g].svgcode?(t(),l("span",{key:0,class:"symbologyIcon w-28 h-28",innerHTML:n.value[g].svgcode},null,8,De)):n.value[g].imgUrl?(t(),l("img",{key:1,class:"symbologyIcon w-28 h-28",src:n.value[g].imgUrl},null,8,Se)):j("",!0)],6))),128))])):n.value.length>0?(t(),l("div",He,[_("div",je,[n.value[0].svgcode?(t(),l("span",{key:0,innerHTML:n.value[0].svgcode},null,8,Be)):n.value[0].imgUrl?(t(),l("img",{key:1,class:"symbologyIcon w-full h-full",src:n.value[0].imgUrl},null,8,Oe)):j("",!0)])])):j("",!0)],2),_("div",Ne,[v.result.loaded?(t(),l("div",Ae,H(v.result.items.length),1)):j("",!0)])])):(t(),l("div",qe,p[0]||(p[0]=[_("div",{class:"symbologyIcon h-32 w-32"},[_("div",{class:"relative animate-spin spinner h-24 w-24"})],-1)])))}}),Pe=oe(Fe,[["__scopeId","data-v-e0b0309a"]]),Ge=["content"],Ue={class:"symbologyLayerName truncate"},Ve=G({__name:"symbology-item",props:{layer:{type:Object,required:!0},result:{type:Object,required:!0},selected:{type:Boolean,required:!0}},setup(v){const b=Y(),n=M(()=>b.properties),d=v,p=()=>{const w=d.layer;return w&&n.value[w.id]&&n.value[w.id].name?n.value[w.id].name:w?.name??""};return(w,g)=>{const T=q("tippy");return A((t(),l("button",{class:R(["flex flex-grow justify-start items-center px-7 py-10 default-focus-style symbologyStackButton truncate",v.selected?"detailsButtonSelected":"px-11"]),onClick:g[0]||(g[0]=me(()=>{},["stop"])),content:p()},[ae(Pe,{class:"symbStack w-32 h-32 mr-10",layer:v.layer,result:v.result},null,8,["layer","result"]),_("div",Ue,H(p()),1)],10,Ge)),[[T,{placement:"right",sticky:!0}]])}}}),Re=["content"],Ze=G({__name:"symbology-list",props:{results:{type:Object,required:!0},selected:{type:String,required:!0}},emits:["selection-changed"],setup(v,{emit:b}){const{t:n}=J(),d=re(),p=x(),w=()=>{p.value._tippy.hide()},g=h=>{h.key==="Tab"&&p.value?.matches(":focus")&&p.value._tippy.show()},T=b,y=v,s=x(""),m=x([]),o=x(!1),e=x(!1),r=h=>d.getLayerByUid(h),$=h=>{s.value=h,T("selection-changed",h),o.value=!1},B=()=>{e.value||setTimeout(()=>{o.value=e.value},500),e.value=!0},C=()=>{o.value=e.value=!1},N=()=>{e.value||(o.value=!0),e.value=!0},c=()=>{o.value=e.value=!1};return ee(()=>{m.value.push(V(y,()=>{s.value=y.selected}))}),ie(()=>{p.value?.addEventListener("blur",w),p.value?.addEventListener("keyup",g)}),te(()=>{m.value.forEach(h=>h()),p.value?.removeEventListener("blur",w),p.value?.removeEventListener("keyup",g)}),(h,E)=>{const O=q("focus-item"),F=q("focus-list"),D=q("tippy");return A((t(),l("div",{class:R(["symbology-list absolute overflow-hidden z-50 p-0 w-48 bg-white text-sm inline-flex flex-col",{"symbology-list-expanded":o.value}]),onMouseover:B,onMouseleave:C,onFocus:N,onBlur:me(c,["self"]),content:L(n)("details.layers.results.list.tooltip"),ref_key:"el",ref:p},[(t(!0),l(K,null,X(y.results,(I,i)=>(t(),l("div",{class:"flex justify-start relative",key:i},[A((t(),Z(Ve,{key:I.uid,layer:r(I.uid),result:I,selected:I.uid===s.value,onClick:u=>$(I.uid)},null,8,["layer","result","selected","onClick"])),[[O]])]))),128))],42,Re)),[[F],[D,{trigger:"manual",placement:"top-start",touch:!1}]])}}}),Je={class:"inline font-bold"},Ke=["innerHTML"],Qe=G({__name:"esri-default",props:{fixtureFields:{type:Object,required:!1},fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},setup(v){const{t:b}=J(),n=se("iApi"),d=v,p=(s,m,o,e)=>{const r=s.find($=>$[m].toLowerCase()===o.toLowerCase());r&&delete e[r.name]},w=()=>{const s=Object.assign({},d.identifyData.data);p(d.fields,"type","geometry",s),n.ui.exposeOids||p(d.fields,"type","oid",s),n.ui.exposeMeasurements||(p(d.fields,"name","shape_length",s),p(d.fields,"name","shape_area",s));const m={};d.fields.forEach(e=>{const r=d.fixtureFields?.find($=>e.name===$.field);m[e.name]={name:r?.alias||e.alias||e.name,type:e.type,visible:r?.visible??!0}});const o={};Object.keys(s).forEach(e=>{const r=m[e];if(r&&r.visible){const $=s[e];o[e]={value:typeof $=="number"?n.ui.formatNumber($):$,alias:r.name,type:r.type}}});for(const[e]of Object.entries(o))n.ui.isPlainText(o[e].value)&&(o[e].value=n.ui.escapeHtml(o[e].value));return o},g=(s,m,o)=>{switch(o){case"date":return y(s);default:return T(s,m)}},T=(s,m)=>{if(!s)return s;if(s.trim().match(/\.(jpeg|jpg|gif|png)$/)||s.trim().match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i))return`<img src="${s}" alt="${b("details.item.alert.defaultAltText",{alias:m})}" />`;const o="underline text-blue-700 break-all",e=document.createElement("div");return e.innerHTML=s.trim(),e.firstElementChild?.tagName=="A"?(e.firstElementChild.className=o,e.innerHTML):ye(s,{className:o,target:"_blank",validate:{url:$=>/^https?:\/\//.test($)}})},y=s=>{const m=parseInt(s);return isNaN(m)?s:new Date(m).toISOString().split("T")[0]};return(s,m)=>(t(),l("div",null,[(t(!0),l(K,null,X(w(),(o,e,r)=>(t(),l("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:r},[_("span",Je,H(o.alias),1),m[0]||(m[0]=_("span",{class:"flex-auto"},null,-1)),_("span",{class:"inline",innerHTML:g(o.value,o.alias,o.type)},null,8,Ke)]))),128))]))}}),We=["innerHTML"],Xe={key:1},Ye=G({__name:"html-default",props:{identifyData:{type:Object,required:!0}},setup(v){const{t:b}=J();return(n,d)=>v.identifyData?(t(),l("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:v.identifyData.data.data??v.identifyData.data},null,8,We)):(t(),l("div",Xe,H(L(b)("details.layers.results.empty")),1))}}),et={class:"relative flex flex-grow truncate"},tt={key:0,class:"flex flex-grow items-center truncate"},st={class:"flex p-8 items-center"},lt=["innerHTML"],at={key:1,class:"symbologyIcon p-6"},nt=["content","innerHTML","tabindex"],it={key:1,class:"flex p-6 flex-grow"},ot={key:2,class:"zoomButton text-center p-3"},rt=["content","aria-label"],ut={key:0,class:"m-auto animate-spin spinner h-20 w-20"},ct={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"green",class:"m-auto w-20 h-20"},dt={key:2,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"red",class:"m-auto w-20 h-20"},vt=["innerHTML"],fe=G({__name:"result-item",props:{uid:{type:String,required:!0},data:{type:Object,required:!0},open:{type:Boolean,required:!1},inList:{type:Boolean,required:!1}},setup(v){const b=re(),n=v,d=se("iApi"),p=x([]),w=Y(),{t:g}=J(),T=x(!1),y=x(""),s=x("none"),m=x(),o=()=>b.getLayerByUid(n.uid),e=M(()=>w.properties),r=M(()=>w.defaultTemplates),$=M(()=>o()?.supportsFeatures??!1),B=M(()=>o()?.mapLayer??!1),C=M(()=>{const i=o();let u=i&&n.data.loaded?i.nameValue(n.data.data):d.$i18n.t("details.items.title");return d.ui.isPlainText(u)&&(u=d.ui.escapeHtml(u)),u}),N=i=>{if(typeof i=="string"){const u="underline text-blue-700 break-all",f=document.createElement("div");return f.innerHTML=i.trim(),f.firstElementChild?.tagName=="A"?(f.firstElementChild.className=u,f.innerHTML):ye(i,{className:u,target:"_blank",validate:{url:z=>/^https?:\/\//.test(z)}})}return i},c=()=>{D("none"),n.data.loaded?h():n.data.load().then(()=>{h()})},h=()=>{if(y.value="",!(n.data&&n.data.loaded))return;const i=o();if(i===void 0){console.warn(`could not find layer for uid ${n.uid} during icon lookup`);return}if(i.supportsFeatures){const u=i.oidField;i.getIcon(n.data.data[u]).then(f=>{y.value=f})}},E=M(()=>{const i=o(),u=i&&e.value[i.id]&&e.value[i.id].template;if(u){if(typeof de(u)!="string")return u;console.error(`Could not find custom details template named ${u}. Was it registered correctly?`)}return r.value&&r.value[n.data.format]?r.value[n.data.format]:$.value?Qe:Ye}),O=M(()=>$.value?o()?.fields||[]:[]),F=M(()=>{const i=o();if(i&&e.value[i.id]&&e.value[i.id].fields)return e.value[i.id].fields}),D=i=>{i==="zoomed"||i==="error"?setTimeout(()=>{s.value=i,m.value?._tippy.show(),setTimeout(()=>{m.value?._tippy.hide(),s.value="none"},3e3)},300):s.value=i},I=()=>{if(s.value!=="none")return;D("zooming");const i=o();if(i===void 0||!i.isLoaded){console.warn(`Could not find layer for uid ${n.uid} during zoom geometry lookup`),D("error");return}if(!n.data.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs."),D("error");return}const u=n.data.data[i.oidField],f=()=>{const S={getGeom:!0};i.getGraphic(u,S).then(z=>{z.geometry.invalid()?(console.error(`Could not find graphic for objectid ${u}`),D("error")):(d.geo.map.zoomMapTo(z.geometry),D("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom")))}).catch(()=>{D("error")})};i.layerType===Te.FEATURE&&i.geomType!==$e.POINT?i.getGraphicExtent(u).then(S=>{d.geo.map.zoomMapTo(S),D("zoomed"),d.updateAlert(d.$i18n.t("details.item.alert.zoom"))}).catch(()=>{f()}):f()};return ee(()=>{p.value.push(V(n,()=>{c()},{deep:!1,immediate:!0}))}),te(()=>{p.value.forEach(i=>i())}),(i,u)=>{const f=q("truncate"),S=q("tippy");return t(),l(K,null,[_("div",et,[$.value?(t(),l("div",tt,[_("div",st,[v.data.loaded&&y.value?(t(),l("span",{key:0,class:"flex-none symbologyIcon",innerHTML:y.value},null,8,lt)):(t(),l("div",at,u[3]||(u[3]=[_("div",{class:"animate-spin spinner h-20 w-20"},null,-1)])))]),v.data.loaded?A((t(),l("span",{key:0,class:"pl-3 text-left flex-grow itemName",content:C.value,innerHTML:N(C.value),onTouchstart:u[0]||(u[0]=z=>T.value=!0),onTouchend:u[1]||(u[1]=z=>T.value=!1),tabindex:v.inList?-1:0},null,40,nt)),[[f,{options:{placement:"top-start",offset:()=>T.value?[0,25]:[0,0]}}]]):(t(),l("div",it,H(L(g)("details.loading")),1)),v.data.loaded?(t(),l("span",ot,[B.value?A((t(),l("button",{key:0,type:"button",content:L(g)(`details.item.zoom${s.value==="none"?"":`.${s.value}`}`),"aria-label":L(g)(`grid.cells.zoom${s.value==="none"?"":`.${s.value}`}`),ref_key:"zoomButton",ref:m,onClick:u[2]||(u[2]=z=>{z.stopPropagation(),I()}),class:"text-gray-600 w-24 h-24 p-2 flex justify-center items-center"},[s.value==="zooming"?(t(),l("div",ut)):s.value==="zoomed"?(t(),l("svg",ct,u[4]||(u[4]=[_("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1)]))):s.value==="error"?(t(),l("svg",dt,u[5]||(u[5]=[_("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(t(),l("span",{key:3,innerHTML:L(d).ui.getZoomIcon()},null,8,vt))],8,rt)),[[S,{placement:"bottom"}]]):j("",!0)])):j("",!0)])):j("",!0)]),v.open?(t(),Z(de(E.value),{key:0,identifyData:v.data,fields:O.value,fixtureFields:F.value,class:"p-8"},null,8,["identifyData","fields","fixtureFields"])):j("",!0)],64)}}}),ft={key:0,class:"layerName w-full flex-grow p-5 pb-8 font-bold truncate",tabIndex:"0"},pt={key:1,class:"p-8 mb-8 bg-gray-100 flex justify-between"},mt={for:"toggle"},yt={key:2,class:"flex flex-col justify-between p-8 mb-8 bg-gray-100"},gt={class:"flex"},ht=["aria-label"],_t=["content","aria-label","disabled"],bt={class:"px-3 text-center flex-grow"},kt=["content","aria-label","disabled"],xt={key:3},Lt={key:0},wt=["content"],Tt=["onClick"],$t={key:1,class:"text-center"},Mt={key:4,class:"p-5"},Et=G({__name:"result-list",props:{uid:{type:String,required:!0},results:{type:Object,required:!0}},setup(v){const b=x(),n=()=>{b.value._tippy.hide()},d=a=>{a.key==="Tab"&&b.value?.matches(":focus")&&b.value._tippy.show()},p=se("iApi"),w=Y(),g=re(),T=v,{t:y}=J(),s=x(!1),m=x(p.fixture.get("details")),o=x(!0),e=x(!1),r=x(0),$=x(20),B=x([]),C=x([]),N=M(()=>w.activeGreedy),c=M(()=>w.properties),h=M(()=>r.value+$.value),E=()=>g.getLayerByUid(T.uid),O=()=>T.results.find(a=>a.uid===T.uid),F=M(()=>O()?.loaded??!1),D=M(()=>O()?.requestTime),I=M(()=>s.value&&(!e.value&&f().length>1||e.value&&f().length>$.value)),i=M(()=>{const a=E();return a&&c.value[a.id]&&c.value[a.id].name?c.value[a.id].name:a?.name??""}),u=M(()=>T.uid),f=()=>{const a=O();return a?a.items:[]},S=M(()=>f()[r.value]),z=M(()=>{if(m.value.hasHilighter()){const a=E();if(a)return a.mapLayer&&a.supportsFeatures}return!1}),ge=a=>{o.value=a,w.hilightToggle=a,P()},he=()=>{const a=E();r.value=r.value??0,o.value=w.hilightToggle??o.value,e.value=!1,s.value=!!a,P()},ue=a=>{e.value?(r.value+=a*$.value,P()):r.value+=a},P=async(a=!1)=>{if(o.value&&z.value){if(a){const U=O();U&&await U.loading}const k=f();if(F.value&&k.length>0){if(e.value)m.value.hilightDetailsItems(k.slice(r.value,h.value),T.uid);else{const U=k[r.value];U&&m.value.hilightDetailsItems([U],T.uid)}return}}m.value.removeDetailsHilight()},_e=()=>{e.value=!0,r.value=Math.floor(r.value/$.value)*$.value,P()},be=()=>{m.value.removeDetailsHilight(),C.value.forEach(a=>a()),B.value.forEach(a=>p.event.off(a))},ke=()=>{m.value.removeDetailsHilight()},xe=a=>{const k=r.value;r.value=a,e.value=!1,k===a&&P()};return ie(()=>{B.value.push(p.event.on(W.LAYER_REMOVE,a=>{const k=p.panel.get("details");T.uid===a.uid&&k&&k.close()})),B.value.push(p.event.on(W.PANEL_CLOSED,a=>{a.id==="details"&&be()})),B.value.push(p.event.on(W.PANEL_MINIMIZED,a=>{a.id==="details"&&ke()})),B.value.push(p.event.on(W.MAP_BASEMAPCHANGE,a=>{o.value&&a.schemaChanged&&P()})),b.value?.addEventListener("blur",n),b.value?.addEventListener("keyup",d)}),ee(()=>{C.value.push(V(S,()=>{e.value||(he(),S.value===void 0&&m.value.removeDetailsHilight())},{deep:!1,immediate:!0})),C.value.push(V(u,()=>{const a=T.uid;if(e.value&&a){const k=O();k&&k.loading.then(()=>{T.uid===a&&e.value&&P()})}},{deep:!1,immediate:!0})),C.value.push(V(D,()=>{r.value=0,e.value&&P(!0)})),C.value.push(V(()=>T.uid,()=>{r.value=0}))}),te(()=>{b.value?.removeEventListener("blur",n),b.value?.removeEventListener("keyup",d)}),(a,k)=>{const U=q("truncate"),le=q("tippy"),Le=q("focus-item"),we=q("focus-list");return F.value&&N.value===0?(t(),l("div",{key:0,class:"detailsContent relative flex flex-col flex-grow pl-5",style:pe(v.results.length>1?{"margin-left":"42px"}:"")},[s.value?A((t(),l("h1",ft,[ne(H(i.value),1)])),[[U,{options:{placement:"top-start"}}]]):j("",!0),z.value?(t(),l("div",pt,[_("label",mt,H(L(y)("details.togglehilight.title")),1),ae(Ie,{config:{value:o.value,disabled:!1},onToggled:ge},null,8,["config"])])):j("",!0),I.value?(t(),l("div",yt,[_("div",gt,[e.value?j("",!0):(t(),l("button",{key:0,type:"button",class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":L(y)("details.item.see.list"),onClick:k[0]||(k[0]=Q=>_e())},H(L(y)("details.item.see.list")),9,ht)),_("div",{class:R(["flex ml-auto bg-gray-200 py-8 items-center",{"w-full":e.value}])},[A((t(),l("button",{type:"button",content:L(y)(e.value?"details.items.previous":"details.item.previous.item"),onClick:k[1]||(k[1]=Q=>ue(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":L(y)(e.value?"details.items.previous":"details.item.previous.item"),disabled:r.value===0},k[3]||(k[3]=[_("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[_("g",null,[_("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,_t)),[[le,{placement:"top"}]]),_("span",bt,H(e.value?L(y)("details.items.range",[r.value+1,Math.min(h.value,f().length),f().length]):L(y)("details.item.count",[r.value+1,f().length])),1),A((t(),l("button",{type:"button",content:L(y)(e.value?"details.items.next":"details.item.next.item"),onClick:k[2]||(k[2]=Q=>ue(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":L(y)(e.value?"details.items.next":"details.item.next.item"),disabled:!e.value&&r.value===f().length-1||e.value&&h.value>=f().length},k[4]||(k[4]=[_("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[_("g",null,[_("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1)]),8,kt)),[[le,{placement:"top"}]])],2)])])):j("",!0),s.value?(t(),l("div",xt,[f().length>0?(t(),l("div",Lt,[e.value?A((t(),l("div",{key:0,class:"flex flex-col",content:L(y)("details.layers.results.list.tooltip"),ref_key:"el",ref:b},[(t(!0),l(K,null,X(f().slice(r.value,h.value),(Q,ce)=>A((t(),l("button",{class:"flex flex-grow truncate default-focus-style hover:bg-gray-200",key:ce,onClick:St=>xe(r.value+ce)},[ae(fe,{data:Q,uid:v.uid,open:!1,"in-list":!0},null,8,["data","uid"])],8,Tt)),[[Le,"show-truncate"]])),128))],8,wt)),[[we],[le,{trigger:"manual",placement:"top-start",touch:!1}]]):(t(),Z(fe,{key:1,data:S.value,uid:v.uid,open:!0,"in-list":!1},null,8,["data","uid"]))])):(t(),l("div",$t,H(L(y)("details.layers.results.empty.currentLayer")),1))])):(t(),l("div",Mt,H(L(y)("details.item.no.data")),1))],4)):(t(),l("div",{key:1,class:R(["flex justify-center py-10 items-center",v.results.length>1?"ml-42":""])},[k[5]||(k[5]=_("span",{class:"animate-spin spinner h-20 w-20 px-5 mr-8"},null,-1)),ne(" "+H(L(y)("details.item.loading")),1)],2))}}}),It=oe(Et,[["__scopeId","data-v-2eb3e1d9"]]),Ct={class:"relative h-full"},zt={class:"detailsContentSection overflow-y-auto h-full"},Dt=G({__name:"details-screen",props:{panel:{type:Object}},setup(v){const{t:b}=J(),n=se("iApi"),d=Y(),p=x([]),w=x([]),g=x([]),T=x(!1),y=x(""),s=M(()=>d.activeGreedy),m=M(()=>d.payload),o=M(()=>d.properties),e=c=>{y.value=c},r=c=>g.value.find(h=>h.uid===c),$=c=>{c!==void 0&&(d.activeGreedy=c.length===0?0:c[0].requestTime,g.value=c,B(c))},B=c=>{if(y.value){const h=r(y.value);h?h.loading.then(()=>{h.requestTime===s.value&&(h.items.length>0?N(!1):C(c))}):C(c)}else C(c)},C=(c,h)=>{let E;if(h)E=h;else{const I=d.properties,i=c.map(f=>[I[f.layerId]?.priority??50,f.layerId]),u=new Set(i.map(f=>f[0]));E=[],u.forEach(f=>{const S=i.filter(z=>z[0]===f).map(z=>z[1]);E.push([f,S])}),E.sort((f,S)=>S[0]-f[0])}if(E.length===0){m.value.length?N(!0):Ee().then(()=>{N(!0)});return}const O=E[E.length-1][1],F=c.filter(I=>O.includes(I.layerId)).map(I=>I.loading.then(()=>I.items.length>0?Promise.resolve(I):Promise.reject())),D=c.length===0?0:c[0].requestTime;Promise.any(F).then(I=>{I.requestTime===s.value&&(y.value=I.uid,N(!1))}).catch(()=>{D===s.value&&(E.pop(),C(c,E))})},N=c=>{d.activeGreedy=0,T.value=c};return ee(()=>{w.value.push(V(m,c=>{$(c)},{deep:!1,immediate:!0}))}),te(()=>{p.value.forEach(c=>n.event.off(c)),w.value.forEach(c=>c())}),(c,h)=>{const E=Me("panel-screen");return t(),Z(E,{panel:v.panel},{header:ve(()=>[ne(H(L(d).origin==="toggleEvent"?L(b)("details.layers.title.gridOrigin"):L(b)("details.layers.title.identifyOrigin")),1)]),content:ve(()=>[_("div",Ct,[g.value.length>1?(t(),Z(Ze,{key:0,results:g.value,detailsProperties:o.value,selected:y.value,onSelectionChanged:e},null,8,["results","detailsProperties","selected"])):j("",!0),_("div",zt,[T.value?(t(),l("div",{key:1,class:R(["text-center",{"ml-42":g.value.length>1}])},H(g.value.length>=1?L(b)("details.layers.results.empty"):L(b)("details.layers.results.empty.noLayers")),3)):(t(),Z(It,{key:0,uid:y.value,results:g.value},null,8,["uid","results"]))])])]),_:1},8,["panel"])}}}),Ot=oe(Dt,[["__scopeId","data-v-3f22bc67"]]);export{Ot as default};
